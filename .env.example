# =============================================================================
# FluxCaption AI Subtitle Translation System - Environment Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# API & Application
# -----------------------------------------------------------------------------
API_BASE_URL=http://0.0.0.0:8000
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=true

# Environment: development | production | testing
ENVIRONMENT=development

# CORS Origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# Supported DB_VENDOR: postgres | mysql | sqlite | mssql
DB_VENDOR=postgres

# PostgreSQL (default)
DATABASE_URL=postgresql+psycopg://fluxcaption:fluxcaption@postgres:5432/fluxcaption

# MySQL/MariaDB (alternative)
# DATABASE_URL=mysql+pymysql://fluxcaption:fluxcaption@mysql:3306/fluxcaption

# SQLite (alternative - for development only)
# DATABASE_URL=sqlite:///./fluxcaption.db

# SQL Server (alternative)
# DATABASE_URL=mssql+pyodbc:///?odbc_connect=DRIVER={ODBC Driver 18 for SQL Server};SERVER=mssql;DATABASE=fluxcaption;UID=sa;PWD=YourPassword123

# Database Pool Settings
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=10
DB_POOL_PRE_PING=true

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_URL=redis://redis:6379/0
REDIS_MAX_CONNECTIONS=50

# -----------------------------------------------------------------------------
# Celery Configuration
# -----------------------------------------------------------------------------
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0
CELERY_TASK_TRACK_STARTED=true
CELERY_TASK_TIME_LIMIT=3600
CELERY_WORKER_MAX_TASKS_PER_CHILD=100
CELERY_WORKER_PREFETCH_MULTIPLIER=4

# -----------------------------------------------------------------------------
# Jellyfin Integration
# -----------------------------------------------------------------------------
JELLYFIN_BASE_URL=http://jellyfin:8096
JELLYFIN_API_KEY=your_jellyfin_api_key_here

# Jellyfin Request Settings
JELLYFIN_TIMEOUT=30
JELLYFIN_MAX_RETRIES=3
JELLYFIN_RATE_LIMIT_PER_SECOND=10

# -----------------------------------------------------------------------------
# Ollama Configuration
# -----------------------------------------------------------------------------
OLLAMA_BASE_URL=http://ollama:11434
OLLAMA_KEEP_ALIVE=30m
OLLAMA_TIMEOUT=300

# Default Model for Translation
DEFAULT_MT_MODEL=qwen2.5:7b-instruct

# Model Pull Settings
OLLAMA_PULL_TIMEOUT=3600
OLLAMA_PULL_RETRY_DELAY=5

# -----------------------------------------------------------------------------
# ASR (Automatic Speech Recognition) Configuration
# -----------------------------------------------------------------------------
# faster-whisper model: tiny | base | small | medium | large-v2 | large-v3
ASR_MODEL=medium

# ASR Compute Type: int8 | int8_float16 | float16 | float32
ASR_COMPUTE_TYPE=int8

# ASR Device: cpu | cuda | auto
ASR_DEVICE=auto

# ASR Settings
ASR_BEAM_SIZE=5
ASR_BEST_OF=5
ASR_VAD_FILTER=true
ASR_VAD_THRESHOLD=0.5
ASR_LANGUAGE=auto
ASR_MODEL_CACHE_DIR=/app/models/whisper
ASR_NUM_WORKERS=4
ASR_SEGMENT_DURATION=600
ASR_SEGMENT_OVERLAP=10

# -----------------------------------------------------------------------------
# Subtitle & Translation Pipeline
# -----------------------------------------------------------------------------
# Required Languages (comma-separated BCP-47 codes)
REQUIRED_LANGS=zh-CN,en,ja

# Writeback Mode: upload | sidecar
WRITEBACK_MODE=upload

# Subtitle Format Preferences
DEFAULT_SUBTITLE_FORMAT=srt
PRESERVE_ASS_STYLES=true

# Translation Settings
TRANSLATION_BATCH_SIZE=10
TRANSLATION_MAX_LINE_LENGTH=42
TRANSLATION_PRESERVE_FORMATTING=true

# -----------------------------------------------------------------------------
# File Storage
# -----------------------------------------------------------------------------
# Storage Backend: local | s3
STORAGE_BACKEND=local

# Local Storage
TEMP_DIR=/tmp/fluxcaption
SUBTITLE_OUTPUT_DIR=/app/output/subtitles

# S3 Storage (if STORAGE_BACKEND=s3)
# S3_BUCKET=fluxcaption-subtitles
# S3_REGION=us-east-1
# S3_ACCESS_KEY=your_access_key
# S3_SECRET_KEY=your_secret_key

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
# Log Level: DEBUG | INFO | WARNING | ERROR | CRITICAL
LOG_LEVEL=INFO
LOG_FORMAT=json

# Log Output: stdout | file | both
LOG_OUTPUT=stdout
LOG_FILE=/app/logs/fluxcaption.log

# -----------------------------------------------------------------------------
# Security (Optional)
# -----------------------------------------------------------------------------
# API Authentication (if enabled)
# API_KEY_ENABLED=false
# API_KEY=your_secure_api_key_here

# JWT Settings (if using JWT authentication)
# JWT_SECRET_KEY=your-secret-key-min-32-chars
# JWT_ALGORITHM=HS256
# JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# -----------------------------------------------------------------------------
# Performance & Resource Limits
# -----------------------------------------------------------------------------
# Max concurrent tasks per queue
MAX_CONCURRENT_SCAN_TASKS=2
MAX_CONCURRENT_TRANSLATE_TASKS=5
MAX_CONCURRENT_ASR_TASKS=2

# Task Timeouts (seconds)
SCAN_TASK_TIMEOUT=300
TRANSLATE_TASK_TIMEOUT=1800
ASR_TASK_TIMEOUT=3600

# Memory Limits
MAX_UPLOAD_SIZE_MB=500
MAX_AUDIO_DURATION_SECONDS=7200

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
ENABLE_AUTO_SCAN=true
ENABLE_AUTO_PULL_MODELS=true
ENABLE_SIDECAR_WRITEBACK=true
ENABLE_METRICS=true
ENABLE_SWAGGER_UI=true

# -----------------------------------------------------------------------------
# Monitoring & Observability (Optional)
# -----------------------------------------------------------------------------
# Prometheus Metrics
# PROMETHEUS_ENABLED=true
# PROMETHEUS_PORT=9090

# Sentry Error Tracking
# SENTRY_DSN=your_sentry_dsn_here
# SENTRY_ENVIRONMENT=production

# -----------------------------------------------------------------------------
# Development Settings
# -----------------------------------------------------------------------------
# Debug Mode
DEBUG=false

# Reload on Code Changes (development only)
AUTO_RELOAD=true

# Test Database (for testing)
# TEST_DATABASE_URL=sqlite:///./test_fluxcaption.db
